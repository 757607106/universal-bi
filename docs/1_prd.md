# 通用 AI-BI 平台 (Universal AI-BI) - 产品需求文档 (PRD)

## 1. 项目愿景
构建一个跨行业、通用的商业智能平台。用户只需连接数据库，无需编写 SQL，即可通过 AI 对话生成可视化报表。核心理念是 **"元数据驱动 (Metadata Driven)"**，系统不包含特定的业务逻辑（如进销存），而是动态理解用户的数据库结构。

## 2. 用户角色
- **数据管理员 (Admin)**: 负责连接数据库、定义数据集、训练 AI。
- **数据分析师 (Analyst)**: 负责使用 ChatBI 提问、配置仪表盘。

## 3. 核心功能模块 (MVP)

### 3.1 数据源管理 (Connection Hub)
- **功能**: 支持添加、编辑、删除外部数据库连接。
- **支持类型**: PostgreSQL, MySQL (MVP阶段)。
- **核心交互**:
  - 输入 Host, Port, User, Password, DB Name。
  - 点击“测试连接”，后端尝试连接并返回结果。
  - 密码需加密存储。

### 3.2 语义建模层 (Semantic Layer / Dataset)
- **功能**: 定义 AI 的“知识边界”。
- **流程**:
  1.  新建数据集 (如 "Q1 销售分析")，选择一个数据源。
  2.  **表选择器**: 系统自动列出该库所有表，用户勾选需要分析的表 (如 `orders`, `users`)。
  3.  **Schema 同步**: 后端自动读取选定表的字段结构、注释。
  4.  **模型训练**: 点击“训练”，系统提取 DDL 和元数据，注入向量数据库。

### 3.3 智能问答 (ChatBI)
- **功能**: 基于选定的数据集进行自然语言问答。
- **交互**:
  - 顶部下拉框：切换数据集 (切换 AI 上下文)。
  - 对话框：输入 "上周销售额是多少？"。
  - 响应：
    - 展示思考过程 (Loading)。
    - 展示生成的 SQL (默认折叠)。
    - 展示 AI 总结的文字。
    - **自动渲染图表**: 根据数据特征自动选择 柱状图/折线图/表格。

### 3.4 仪表盘 (Dashboard)
- **功能**: 将 ChatBI 生成的图表固化保存。
- **交互**: 在对话框中点击 "保存到仪表盘"，该图表卡片会被添加到的看板中。

## 4. 非功能性需求
- **安全性**: 外部数据库密码必须加密存储 (Fernet)。
- **隔离性**: 不同数据集的向量索引必须物理或逻辑隔离，防止 AI 幻觉。
- **性能**: 常用查询结果需缓存 (Redis)。