# 通用 AI-BI 平台 (Universal AI-BI) - 产品需求文档 (PRD)

> **文档版本**: v1.1  
> **最后更新**: 2026-01-08

## 1. 项目愿景

构建一个跨行业、通用的商业智能平台。用户只需连接数据库，无需编写 SQL，即可通过 AI 对话生成可视化报表。核心理念是 **"元数据驱动 (Metadata Driven)"**，系统不包含特定的业务逻辑（如进销存），而是动态理解用户的数据库结构。

## 2. 用户角色

| 角色 | 职责 | 权限 |
|------|------|------|
| **超级管理员 (Superuser)** | 管理所有用户、系统配置 | 全系统访问、用户管理 |
| **数据管理员 (Admin)** | 连接数据库、定义数据集、训练 AI | 数据源、数据集、训练管理 |
| **数据分析师 (Analyst)** | 使用 ChatBI 提问、配置仪表盘 | 查询、仪表盘、报表 |

## 3. 核心功能模块

### 3.1 数据源管理 (Connection Hub)

- **功能**: 支持添加、编辑、删除外部数据库连接
- **支持类型**: PostgreSQL, MySQL
- **安全特性**: 密码 Fernet 加密存储
- **核心交互**:
  - 输入 Host, Port, User, Password, DB Name
  - 点击"测试连接"，后端尝试连接并返回结果
  - 支持多租户数据隔离 (owner_id)

### 3.2 语义建模层 (Semantic Layer / Dataset)

- **功能**: 定义 AI 的"知识边界"
- **流程**:
  1. 新建数据集，选择一个数据源
  2. **表选择器**: 系统自动列出该库所有表，用户勾选需要分析的表
  3. **Schema 同步**: 后端自动读取选定表的字段结构、注释
  4. **模型训练**: 异步训练，支持进度显示和中断控制

### 3.3 可视化建模 (Visual Modeling)

- **功能**: 拖拽式可视化建模界面
- **特性**:
  - VueFlow 画布拖拽添加表
  - AI 自动分析表关联关系
  - 手动连线编辑关联
  - SQL 预览与宽表视图创建

### 3.4 智能问答 (ChatBI)

- **功能**: 基于选定的数据集进行自然语言问答
- **特性**:
  - 自然语言转 SQL (Vanna AI)
  - 多轮推理与澄清机制
  - 自动图表渲染 (柱状图/折线图/表格)
  - **反馈闭环 (RLHF)**: 点赞/点踩自动训练优化
  - Redis 查询缓存加速

### 3.5 仪表盘 (Dashboard)

- **功能**: 将 ChatBI 生成的图表固化保存
- **特性**:
  - 网格布局展示
  - 卡片管理 (CRUD)
  - 多租户数据隔离

### 3.6 用户认证与权限 (SaaS)

- **功能**: 完整的用户管理系统
- **特性**:
  - JWT 认证 + Token 黑名单
  - 用户注册/登录/退出
  - 超级管理员用户管理
  - 前端路由守卫

## 4. 非功能性需求

| 需求 | 实现方式 |
|------|----------|
| **安全性** | 数据库密码 Fernet 加密、用户密码 BCrypt 哈希 |
| **隔离性** | 多租户数据隔离 (owner_id)、向量索引 Collection 隔离 |
| **性能** | Redis SQL 查询缓存、异步训练 |
| **可扩展性** | 模块化服务架构、Docker 容器化部署 |
